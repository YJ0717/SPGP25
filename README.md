# 📱 SPGP 기말 프로젝트 <br>

## 게임제목: 페글팡 <br>

--- <br>

## 🎮 게임 컨셉 <br>

### High Concept <br>

페글팡은 페글린과 애니팡의 게임 스타일을 결합한 로그라이크 퍼즐장르 입니다. <br>

플레이어는 퍼즐 보드에서 블럭을 매치해 얻은 점수로 적에게 공격하거나 회복을 수행하여 전투하는 게임입니다. <br>

### 핵심 메카닉 요약 <br>

- **상단 전투 영역**: 턴제 자동 전투 진행, 몬스터마다 약점 속성 존재 <br>

- **하단 퍼즐 영역**: 6x6 보드, 3종 블럭(칼/물약/마법) 매칭으로 전투 영향 <br>

- **특성 시스템**: 각 스테이지에서 전투/퍼즐 특성을 하나씩 선택하여 공략 전략 변경 <br>

--- <br>

## 🛠️ 개발 범위 <br>

- 퍼즐 판: **6 x 6**, 블럭 3종류 (칼, 물약, 마법) <br>

- 매치 방식: **가로/세로 3개 이상 일치 시 발동**, 대각선 제외 <br>

- 전투 방식: **턴제 전투**, 적은 물리/마법 타입 중 하나만 피해를 입음 <br>

- 특성 시스템: **스테이지당 2개 특성 선택** <br>
  - 전투 특성 예: 데미지 +20%, 적의 공격 1턴 지연 등 <br>
  - 퍼즐 특성 예: 폭탄 블럭 등장, 추가 힐 효과 등 <br>

- 월드 구조: <br>
  - **총 3개의 월드** <br>
  - 각 월드당 **3스테이지** (예: 1-1, 1-2, 1-3(보스)) <br>

---

## 🧩 예상 게임 실행 흐름 <br>

1. 게임 시작 → 월드 선택 <br>

2. 스테이지 선택 (예: 1-1) <br>

3. 퍼즐 플레이 (6x6 보드 매치) <br>

4. 퍼즐 결과 기반 전투 수행 <br>

5. 적의 턴 진행 <br>

6. 특성 2개 선택 (전투 + 퍼즐) <br>

7. 플레이어가 승리하면 다음 스테이지 진행 <br>

--- <br>

## 🖼️ 게임 진행 흐름 예시 (스크린샷) <br>

<h3>- 게임 시작:</h3>
<img src="https://github.com/user-attachments/assets/e7d1797f-5f34-4bb1-8e32-0899332a7f3b" width="800"/>

<h3>- 월드 선택:</h3>
<img src="https://github.com/user-attachments/assets/4427daf1-c703-485e-a936-b1e0a40656b6" width="800"/>

<h3>- 스테이지 선택:</h3>
<img src="https://github.com/user-attachments/assets/0efbca80-f9c8-4e70-bc2d-273fab6e7d17" width="800"/>

<h3>- 전투 상단:</h3>
<img src="https://github.com/user-attachments/assets/5ef57b13-4388-43de-b774-fc57e0edfa22" width="800"/>

<h3>- 전투 중단:</h3>
<img src="https://github.com/user-attachments/assets/efde59ca-d0ec-4cb4-812f-2c77a65b96e7" width="800"/>

<h3>- 전투 하단:</h3>
<img src="https://github.com/user-attachments/assets/93be8964-b075-47d1-a3a1-ef073fa05425" width="800"/>

<h3>- 특성 선택:</h3>
<img src="https://github.com/user-attachments/assets/644412b9-ac62-4fb0-b866-22349f5d244a" width="400" height="300"/>

<h3>- 순서도:</h3>
<img src="https://github.com/user-attachments/assets/086cb41e-44c6-4c0a-9c6a-4d8ecc46a1ef" width="1800"/>


--- <br>

## 주차별 커밋수
![Image](https://github.com/user-attachments/assets/79036ef8-da2a-4e9e-9d27-b8495a98c07c)

--- <br>
## 📆 개발 일정표 (총 8주)

| 주차               | 개발 내용 |
|--------------------|-----------|
| 1주차 (4/8 ~ 4/12)  | 에셋 탐색 및 시작 화면 구성  100% |
| 2주차 (4/13 ~ 4/19) | 월드 선택 및 스테이지 진입 흐름 구현, 퍼즐 로직 기본 구조 설계 및 구현 (6x6 보드, 매치3)  100% |
| 3주차 (4/20 ~ 4/26) | 퍼즐 로직 완성 및 디테일 조정 (매치 판정, 블럭 제거 등)  100% | 
| 4주차 (4/27 ~ 5/3)  | 스테이지 1-1 몬스터 구현, 블럭 매칭 결과 처리 (공격/힐 연동)  100% |
| 5주차 (5/4 ~ 5/10)  | 전투 시스템 구현 (적 생성, HP/공격 턴 처리 등)  60% |
| 6주차 (5/11 ~ 5/17) | 특성 시스템 구현 (전투/퍼즐 특성 적용), 월드 1 (1-1, 1-2, 1-3 보스) 완성 | 
| 7주차 (5/18 ~ 5/24) | 월드 2, 월드 3 스테이지 구현 | 
| 8주차 (5/25 ~ 5/31) | 전체 UI 정리, 배경 음악 및 효과음 삽입, 게임 밸런싱, 버그 수정  | 

--- <br>

## 🎮 게임 오브젝트 구성

### MainScene
- 구성: 게임의 메인 씬, 기본 UI 요소 포함
- 상호작용: 터치 이벤트 처리, 씬 전환

### BaseStageScene
- 구성: 모든 스테이지의 기본 클래스, 공통 UI 요소와 기능 포함
- 상호작용: 뒤로가기 버튼, 스테이지별 특수 요소 설정

### Block
- 구성: 3가지 타입(힐, 마법, 검)의 블록 객체
- 상호작용: 블록 이동, 매칭, 애니메이션

### (핵심 클래스) BlockGrid
- 구성: 6x6 그리드 시스템, 블록 배열 관리
- 상호작용: 가로나 세로로 3개 이상의 같은 타입 블록이 연속될 때 매치 처리 및 제거, 새로운 블록 생성
- **핵심 역할** :
- 매치된 블록의 타입에 따라 다른 효과 발생 (검: 물리공격, 마법: 마법공격, 물약: 힐링)
- 연쇄 반응 가능 (새로운 블록이 떨어지면서 또 다른 매치가 발생할 수 있음)

### PlayerStats
- 구성: 플레이어의 공격력, 힐링, 게임 시간 정보
- 상호작용: 블록 매칭 결과에 따른 플레이어 스탯 업데이트

### S1_1
- 구성: 스테이지 1-1의 게임 화면, 퍼즐과 전투 영역 포함
- 상호작용: 블록 조작, 전투 시스템 연동

### StageFactory
- 구성: 스테이지 생성 팩토리 클래스
- 상호작용: 스테이지 번호에 따른 적절한 스테이지 객체 생성

### StageManager
- 구성: 스테이지 데이터 관리 시스템
- 상호작용: 스테이지 잠금 해제, 점수 관리

### worldSelectScene
- 구성: 월드 선택 화면, 월드 버튼들
- 상호작용: 월드 선택, 메인 화면으로 복귀
--- <br>

## 🔗 링크 모음

- 🎥 **발표 영상**
  - [1차 발표 영상](https://youtu.be/XScikEudSP4)
  - [2차 발표 영상](#)  
  - [3차 발표 영상](#)

--- <br>

# 📚 최종 텀프로젝트

## 📅 개발 계획/일정/실제 진행

### 개발 진척도 (계획 대비 실제 진행)

| 주차 | 계획된 개발 내용 | 진행률 | 실제 진행 상황 |
|------|------------------|--------|----------------|
| 1주차 | 에셋 탐색 및 시작 화면 구성 | **100%** ✅ | 완료 - 게임 아트 에셋 확보, MainScene 구현 |
| 2주차 | 월드/스테이지 선택, 퍼즐 기본 구조 | **100%** ✅ | 완료 - 6x6 그리드, Match-3 로직 구현 |
| 3주차 | 퍼즐 로직 완성 및 디테일 조정 | **100%** ✅ | 완료 - 블록 매칭, 애니메이션, 연쇄 시스템 |
| 4주차 | 스테이지 1-1, 블록-전투 연동 | **100%** ✅ | 완료 - 첫 번째 보스 전투, 데미지 시스템 |
| 5주차 | 전투 시스템 구현 | **100%** ✅ | 완료 - 턴제 전투, 몬스터 AI, 밸런싱 조정 완료 |
| 6주차 | 특성 시스템, 월드 1 완성 | **100%** ✅ | 완료 - 로그라이크 선택지 구현, 월드 1 전체 완성 |
| 7주차 | 월드 2, 월드 3 구현 | **100%** ✅ | 완료 - 월드 2,3 모든 스테이지 구현 완료 |
| 8주차 | UI 정리, 사운드, 밸런싱 | **100%** ✅ | 완료 - 배경음악/효과음, 버그 수정 완료 |

### 주차별 커밋 현황 (총 103커밋)
![주차별 커밋수](https://github.com/user-attachments/assets/7e62f691-2211-4169-ba6c-3578250d6abb)

### 목표 변경 사항

#### 📈 확장된 목표  
- **난이도 시스템 및 패널티 메커니즘**: 계획에 없던 동적 난이도 조절 시스템 추가
  - *이유*: 게임을 플레이해보니 단조로움이 느껴져 더 도전적인 요소가 필요하다고 판단
  - **월드 2**: 블록 매칭 실패 시 그리드 맨 아래 행에 돌 블록이 쌓이는 패널티 시스템 도입
  - **월드 3**: 몬스터가 직접 퍼즐 영역에 피해를 주는 상호작용 시스템 구현 

## 🛠️ 사용된 기술

### Android 기본 기술
- **Activity & Intent**: MainActivity에서 PegglePangActivity로 전환
- **Custom View**: GameView를 통한 게임 화면 구현
- **Canvas & Paint**: 2D 그래픽 렌더링 (블록, 몬스터, 플레이어 애니메이션)
- **Touch Event Handling**: 블록 스와이프, 버튼 클릭 처리
- **MediaPlayer & SoundPool**: 배경음악 및 효과음 시스템
- **Bitmap & BitmapFactory**: 이미지 리소스 관리
- **SharedPreferences**: 게임 진행상황 저장 (StageManager)

### 게임 개발 기술
- **Frame Animation**: 스프라이트 시트를 이용한 캐릭터 애니메이션
- **State Machine**: 게임 상태 관리 (퍼즐/전투 페이즈)
- **Object Pooling**: 블록 재사용을 통한 메모리 최적화
- **Scene Management**: 다중 씬 시스템
- **Collision Detection**: 블록 매칭 알고리즘

--- <br>

## 📖 참고한 것들

### 게임 메커니즘
- **Puzzle & Dragons**: 퍼즐 RPG 장르의 기본 구조
- **Peggle**: 블록 제거 메커니즘
- **Match-3 게임들**: 3개 이상 매칭 시스템
- **로그라이크 게임들**: 선택지 기반 버프 시스템

### 기술적 참고
- **Fisher-Yates 알고리즘**: 블록 초기화 시 랜덤 배치
- **Builder Pattern**: AlertDialog 생성 방식 참고
- **Factory Pattern**: StageFactory, SoundEffectManager 구현

--- <br>

## 🎓 수업내용에서 차용한 것

### Framework 구조
```java
public class GameView extends View implements Choreographer.FrameCallback {
    public static GameView view;
    private ArrayList<Scene> sceneStack = new ArrayList<>();
    public void update() { scene.update(); }
    public void draw(Canvas canvas) { scene.draw(canvas); }
}
```

### 핵심 수업 내용 적용
- **Custom View 기반 게임**: GameView 클래스로 게임 화면 구현
- **Touch Event Handling**: 블록 스와이프 구현
- **Frame Animation**: 몬스터/플레이어 스프라이트 애니메이션
- **GameObject 관리**: Block, Monster, Player 클래스들
- **Scene 시스템**: 수업의 Multiple Scene 구조 적용
- **Canvas Transform**: 몬스터 flip 기능에서 `canvas.scale(-1f, 1f)` 사용
- **Object Lifecycle Management**: 블록 재사용 시스템
- **Game Loop**: update(), draw() 패턴
- **Resource Management**: Bitmap 로딩 및 관리

### BitmapPool (수업에서 배운 메모리 최적화)
### Event Interface 처리

--- <br>

## 🔧 직접 개발한 것

### 게임 로직
- **블록 매칭 알고리즘**: 3개 이상 연속 블록 탐지 및 제거
- **블록 드롭 시스템**: 중력 효과로 블록이 아래로 떨어지는 물리
- **스마트 블록 생성**: 초기 매치 방지 알고리즘
- **로그라이크 시스템**: 선택지 기반 버프/디버프 시스템

### 전투 시스템
- **턴제 전투**: 퍼즐 결과를 전투에 반영하는 시스템
- **몬스터 AI**: 각 몬스터별 고유 패턴 및 스킬
- **상태이상**: 기절, 공포, 출혈 등 다양한 디버프
- **크리티컬/데미지 감소**: 확률 기반 전투 시스템
- **메모리 최적화**:
- **사운드 시스템**:
- **데이터 관리**:
  - 스테이지 진행상황 저장
  - 로그라이크 선택 지속성

### UI/UX 개선
- **부드러운 애니메이션**: 블록 이동, 몬스터 깜빡임
- **시각적 피드백**: 데미지 텍스트, 이펙트
- **직관적 조작**: 스와이프 기반 블록 조작
- **전체화면 모드**: 몰입감 향상

### 특별한 구현
- **폭탄 블록 시스템**: 십자 모양 블록 제거
- **돌 블록**: 매치 실패 시 추가되는 장애물
- **몬스터별 고유 스킬**:
  - 얼음구슬 발사
  - 분신술
  - 공포 효과
--- <br>

## 😔 아쉬운 것들

### 하고 싶었지만 못 한 것들
- **다양한 그리드**: 요즘 퍼즐게임에서는 그리드 판에 잠금 시스템처럼 추가적인 퍼즐 요소를 제공

- **업그레이드 시스템**: 로그라이크 선택에 따라 스킬 이펙트 진화

### 스토어 출시를 위해 보충할 것들
- **튜토리얼 시스템**: 신규 플레이어를 위한 가이드
- **다양한 애니메이션**: 게임 몰입감
- **사운드 관련**: 퍼즐 게임의 묘미는 시원함인데 사운드가 부족

### 결국 해결하지 못한 문제/버그
- **메모리 누수**: 앱을 오래 키면 프레임이 현저히 떨어짐

---

## 📝 수업에 대한 소감

### 이번 수업에서 기대한 것
- **모바일 게임 개발**: 스마트폰 앱으로 실제 게임을 만들 수 있다는 기대감
- **Android 개발의 전반적 이해**: 단순한 앱이 아닌 복잡한 상호작용이 있는 게임 개발 경험

### 이번 수업에서 얻은 것
- **Android Studio의 강력한 기능들**: 
  - 리팩토링 도구 (Rename, Extract Method 등)
  - 실시간 디버깅과 로그 확인 시스템
  - 자동완성과 코드 제안 기능의 편리함
- **실무에 가까운 개발 경험**: 
  - 메모리 최적화 (BitmapPool)
  - Touch Event 처리와 Canvas 렌더링

### 더 좋은 수업이 되기 위한 제안
- **강의 녹화 제공**: 온라인 수업 때처럼 강의 내용을 녹화해서 제공하면 복잡한 부분을 다시 들을 수 있어 학습에 큰 도움이 될 것 같음.